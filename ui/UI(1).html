<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>è§†é¢‘ç¬”è®°åŠ©æ‰‹</title>
  <style>
    body {
      margin: 0;
      font-family: 'å¾®è½¯é›…é»‘', sans-serif;
      background-image: url("avocado.jpg");
      background-size: cover;
      display: flex;
      height: 100vh;
    }
    .video-container {
      flex: 2;
      background: white;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'å¾®è½¯é›…é»‘';
      border-radius: 16px;
      margin: 20px;
    }
    .chat-container {
      flex: 1;
      background: #f5f5c9;
      padding: 20px;
      display: flex;
      flex-direction: column;
      font-family: 'å¾®è½¯é›…é»‘';
      border-left: 1px solid #ccc;
      border-radius: 16px;
      margin: 20px;
    }
    .chat-box {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 10px;
      padding: 10px;
      background-color: #f5f5c9;
      border: 1px solid #ddd;
      border-radius: 12px;
    }
    .msg {
    margin: 6px 0;
    padding: 8px 12px; /* Adjusted padding for bubble look */
    border: none;
    max-width: 80%;
    border-radius: 18px; /* More rounded corners for bubble */
    word-wrap: break-word; /* Ensure long words break */
    clear: both; /* Clear floats to prevent overlapping */
    }
    .system {
      color: #2a4f33;
      font-weight: normal;
    }
    .system {
    color: #2a4f33;
    background-color: #f5f5c9; /* Light green for system messages */
    align-self: flex-start; /* Align system messages to the left */
    float: left; /* Float left for system messages */
    }
    .user {
    background-color: #d2e8cf; /* A nice light green for user messages */
    color: #333; /* Darker text for better contrast */
    text-align: right; /* Text aligns right within the bubble */
    align-self: flex-end; /* Align user messages to the right */
    float: right; /* Float right for user messages */
    }
    /*
    .user {
      text-align: right;
      color: black;
    }*/
    .chat-box::after {
    content: "";
    display: table;
    clear: both;
    }
    .quick-button {
      width: 150px;
      padding: 10px 12px;
      font-size: 14px;
      border: 2px solid #77bfa3;
      background-color: #d2e8cf;
      border-radius: 12px;
      cursor: pointer;
      font-family: 'å¾®è½¯é›…é»‘';
    }
    input[type="text"] {
      font-family: 'å¾®è½¯é›…é»‘';
      padding: 8px;
      border: 1px solid #77bfa3;
    }
    #chatInput {
    flex: 1;
    padding: 6px;
    border: 2px solid #77bfa3;
    border-radius: 12px;
    }
    button {
      font-family: 'å¾®è½¯é›…é»‘';
      padding: 6px 12px;
      background-color: #d2e8cf;
      border: 2px solid #77bfa3;
      cursor: pointer;
      border-radius: 12px;
    }
  </style>
</head>
<body>

  <div class="video-container">
    <h2>å’Œæˆ‘ä»¬ä¸€èµ·ç§ä¸‹ä¸€é¢—ç‰›æ²¹æœ</h2>
    <video id="myVideo" width="1000" height="680" controls>
      <source src="./videos/ml.mp4" type="video/mp4" />
      æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ video æ ‡ç­¾ã€‚
    </video>
  </div>

  <div class="chat-container">
    <div class="chat-box" id="chatBox">
      <div class="msg system">ä½ å¥½ï¼æˆ‘å¯ä»¥å¸®ä½ åˆ†æè§†é¢‘å¹¶æ€»ç»“ä¸ºå­¦ä¹ ç¬”è®°ã€‚</div>
    </div>
  
    <div style="display: flex; justify-content: flex-end; margin-bottom: 10px; gap: 10px;">
        <button class="quick-button" onclick="sendMessage('æ€»ç»“è§†é¢‘ä¸»è¦å†…å®¹')">æ€»ç»“è§†é¢‘ä¸»è¦å†…å®¹</button>
        <button class="quick-button" onclick="sendMessage('ç”Ÿæˆè§†é¢‘å­¦ä¹ ç¬”è®°')">ç”Ÿæˆè§†é¢‘å­¦ä¹ ç¬”è®°</button>
      </div>
  
    <!-- è¾“å…¥æ¡† -->
    <div style="display: flex; gap: 8px;">
      <input id="chatInput" type="text" placeholder="è¾“å…¥ä½ çš„é—®é¢˜..." 
             style="flex: 1; padding: 6px; border: 2px solid #77bfa3;" />
      <button onclick="sendMessage()" 
              style="border: 2px solid #77bfa3;">å‘é€</button>
    </div>
  </div>
  <style>
    .buttons button {
      width: 200px; /* æˆ–è®¾ç½®å…·ä½“åƒç´ å®½åº¦ï¼Œå¦‚ 200px */
      padding: 10px 16px;
      font-size: 16px;
      border: 2px solid #77bfa3;
      background-color: #d2e8cf;
      border-radius: 6px;
      cursor: pointer;
    }
  
    .buttons {
      display: flex;
      flex-direction: column; /* å‚ç›´æ’åˆ—å¯ç¡®ä¿æŒ‰é’®å¯¹é½ä¸€è‡´ */
      gap: 10px;
    }
  </style>
  
  <script>
    const video = document.getElementById("myVideo");
    const chatBox = document.getElementById("chatBox");
    const chatInput = document.getElementById("chatInput");

    function sendMessage(text) {
      const userText = text || chatInput.value.trim();
      if (!userText) return;

      appendMessageLineByLine('user', userText);
      chatInput.value = '';

      setTimeout(() => {
        const reply = generateMockReply(userText);
        appendMessageLineByLine('system', "æ­£åœ¨ç”Ÿæˆâ€¦â€¦è¯·ç¨å€™");
        setTimeout(() => {
          appendMessageLineByLine('system', reply);
        }, 30000);
        
      }, 500);
    }

    


    function formatOutline(outlineObj) {
      let result = `ğŸ“˜ ${outlineObj.title}\n\n`;

      outlineObj.sections.forEach(section => {
        result += `ğŸ”¹ ${section.id}. ${section.title}\n`;
        section.points.forEach(point => {
          result += `  - ${point}\n`;
        });
        result += '\n';
      });

      return result;
    }




    function appendMessage(role, content) {
      const msg = document.createElement('div');
      msg.className = 'msg ' + role;
      msg.innerHTML = content.replace(/\n/g, "<br>"); // âœ… è¿™é‡Œæ›¿æ¢æ¢è¡Œç¬¦
      chatBox.appendChild(msg);
      chatBox.scrollTop = chatBox.scrollHeight;
    }
    function appendMessageLineByLine(role, content, delay = 80) {
      const lines = content.split('\n'); // æŒ‰è¡Œåˆ‡åˆ†æ–‡æœ¬
      const msgContainer = document.createElement('div');
      msgContainer.className = 'msg ' + role;
      chatBox.appendChild(msgContainer);
      chatBox.scrollTop = chatBox.scrollHeight;

      let i = 0;
      function showNextLine() {
        if (i < lines.length) {
          const line = document.createElement('div');
          line.textContent = lines[i];
          msgContainer.appendChild(line);
          chatBox.scrollTop = chatBox.scrollHeight;
          i++;
          setTimeout(showNextLine, delay);
        }
      }

      showNextLine();
    }



    const multiLineText = {  };
    console.log(multiLineText);
    function generateMockReply(userText) {
      if (userText.includes("æ€»ç»“")) {
        fetch('http://localhost:3000/generate-outline')
          .then(response => response.text())
          .then(data => {
            appendMessage('system', data);
          })
          .catch(err => {
            appendMessage('system', "è¯·æ±‚å‡ºé”™ï¼š" + err.message);
          });
          return formatOutline(multiLineText);
      }
      
      if (userText.includes("å­¦ä¹ ç¬”è®°")) return "å­¦ä¹ ç¬”è®°ï¼š1. ç‰›æ²¹æœå–œæ¬¢é˜³å…‰å……è¶³çš„ç¯å¢ƒï¼›2. éœ€è‰¯å¥½æ’æ°´çš„åœŸå£¤ã€‚";
      return "è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹å›å¤ï¼ˆä½ å¯ä»¥æ¥å…¥çœŸå®æ¥å£ï¼‰";
    }
  </script>

</body>
</html>
